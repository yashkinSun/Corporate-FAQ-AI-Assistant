"""
Модуль для определения приветственных сообщений и фильтрации приветствий.
"""
import re
from typing import Set

# ──────────────────────────────────────────────────────────────────────────────
#  Списки приветствий
# ──────────────────────────────────────────────────────────────────────────────
GREETINGS_RU: Set[str] = {
    "привет", "здравствуйте", "добрый день", "доброе утро", "добрый вечер",
    "приветствую", "здравствуй", "хай", "хеллоу", "хелло", "салют", "прив",
    "доброго времени суток", "доброго дня", "доброго времени", "всем привет"
}

GREETINGS_EN: Set[str] = {
    "hello", "hi", "hey", "greetings", "good morning", "good afternoon",
    "good evening", "good day", "howdy", "what's up", "sup", "hiya"
}

# ──────────────────────────────────────────────────────────────────────────────
#  Регулярки
# ──────────────────────────────────────────────────────────────────────────────
GREETING_PATTERNS_RU = [
    r"^(привет|здравствуй|добр\w+)\b",
    r"^(прив|хай|хелл?оу)\b",
    r"^(салют|приветствую)\b",
    r"^(доброго\s+врем\w+)\b"
]

GREETING_PATTERNS_EN = [
    r"^(hello|hi|hey|greetings)\b",
    r"^(good\s+(morning|afternoon|evening|day))\b",
    r"^(howdy|sup|hiya)\b",
    r"^(what'?s\s+up)\b"
]

# ──────────────────────────────────────────────────────────────────────────────
#  Основная функция
# ──────────────────────────────────────────────────────────────────────────────
def is_greeting(text: str) -> bool:
    """
    Возвращает True, если сообщение является чистым приветствием.
    Считаем приветствием только короткие фразы (≤ 2 слова).
    """
    if not text:
        return False

    # нормализуем
    text = text.lower().strip()
    text = re.sub(r'^[^\w\s]+|[^\w\s]+$', '', text)  # убираем пунктуацию по краям
    words = text.split()

    # ── 1. Если больше 2-х слов → это уже не чистое приветствие
    if len(words) > 2:
        return False

    joined = " ".join(words)

    # ── 2. Проверка по точным спискам
    if joined in GREETINGS_RU or joined in GREETINGS_EN:
        return True

    # ── 3. Проверка по регулярным выражениям
    for pattern in (*GREETING_PATTERNS_RU, *GREETING_PATTERNS_EN):
        if re.fullmatch(pattern, joined, re.IGNORECASE):
            return True

    return False
